{{define "content"}}
<div>
    <div class="mb-1">
        <a href="/orgs/{{.Data.OrgID}}/projects/{{.Data.ProjectID}}/settings" class="link">&larr; Back to Project Settings</a>
    </div>

    <h2 class="mb-1">Flaky Tests</h2>
    <p class="text-muted mb-2">Project: {{.Data.ProjectName}}</p>

    <form method="GET" action="/orgs/{{.Data.OrgSlug}}/projects/{{.Data.ProjectSlug}}/flakes" class="card mb-2">
        <div class="filters-grid">
            <div class="form-group">
                <label for="days">Time Range</label>
                <select name="days" id="days">
                    <option value="7" {{if eq .Data.Days 7}}selected{{end}}>Last 7 days</option>
                    <option value="30" {{if eq .Data.Days 30}}selected{{end}}>Last 30 days</option>
                    <option value="90" {{if eq .Data.Days 90}}selected{{end}}>Last 90 days</option>
                    <option value="365" {{if eq .Data.Days 365}}selected{{end}}>All time</option>
                </select>
            </div>

            <div class="form-group">
                <label for="repo">Repository</label>
                <input type="text" name="repo" id="repo" value="{{.Data.Repo}}" placeholder="e.g., owner/repo">
            </div>

            <div class="form-group">
                <label for="job_name">Job Name</label>
                <input type="text" name="job_name" id="job_name" value="{{.Data.JobName}}" placeholder="e.g., test">
            </div>

            <div class="button-row">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                <a href="/orgs/{{.Data.OrgSlug}}/projects/{{.Data.ProjectSlug}}/flakes" class="btn btn-secondary">Clear</a>
            </div>
        </div>
    </form>

    {{if eq .Data.Total 0}}
    <div class="empty-state">
        {{if or (ne .Data.Repo "") (ne .Data.JobName "")}}
        <p class="mb-0">No flakes match your filters. Try adjusting the filter criteria.</p>
        {{else}}
        <p class="mb-0">No flakes detected in this project.</p>
        {{end}}
    </div>
    {{else}}
    <p class="text-muted mb-1">Showing {{.Data.Total}} flaky test(s)</p>

    <table class="flakes-table">
        <thead>
            <tr>
                <th>Test Identifier</th>
                <th>Repository</th>
                <th>Job</th>
                <th>Flake Score</th>
                <th>Mixed/Total</th>
                <th>Last Seen</th>
            </tr>
        </thead>
        <tbody>
            {{range .Data.Flakes}}
            <tr>
                <td>
                    <a class="link" href="/orgs/{{$.Data.OrgSlug}}/projects/{{$.Data.ProjectSlug}}/flakes/{{.TestCaseID}}?days={{$.Data.Days}}">
                        <strong>{{.TestIdentifier}}</strong>
                    </a>
                </td>
                <td>{{.RepoFullName}}</td>
                <td>
                    {{.JobName}}
                    {{if .JobVariant}}<br><small class="text-muted">{{.JobVariant}}</small>{{end}}
                </td>
                <td>
                    <span class="flake-score flake-score-{{if ge .FlakeScore 0.7}}high{{else if ge .FlakeScore 0.4}}medium{{else}}low{{end}}">
                        {{printf "%.2f" .FlakeScore}}
                    </span>
                </td>
                <td>{{.MixedOutcomeRuns}}/{{.TotalRunsSeen}}</td>
                <td>{{.LastSeenAt.Format "2006-01-02 15:04"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>

    {{if ge .Data.Total 100}}
    <p class="text-muted mt-1">Showing top 100 results. Use filters to narrow down the list.</p>
    {{end}}
    {{end}}
</div>
{{end}}

{{define "content"}}
{{$detail := .Data.Detail}}
<div>
    <div class="mb-1">
        <a href="/orgs/{{.Data.OrgSlug}}/projects/{{.Data.ProjectSlug}}/flakes?days={{.Data.Days}}" class="link">&larr; Back to Flakes List</a>
    </div>

    <div class="card mb-2">
        <h2 class="mb-1">{{$detail.TestIdentifier}}</h2>
        <div class="text-muted mb-1"><strong>Repository:</strong> {{$detail.RepoFullName}}</div>
        <div class="text-muted"><strong>Job:</strong> {{$detail.JobName}}{{if $detail.JobVariant}} ({{$detail.JobVariant}}){{end}}</div>
    </div>

    <div class="stats-grid mb-2">
        <div class="stat-card">
            <div class="stat-label">Flake Score</div>
            <div class="stat-value">
                <span class="flake-score flake-score-{{if ge $detail.FlakeScore 0.7}}high{{else if ge $detail.FlakeScore 0.4}}medium{{else}}low{{end}}">
                    {{printf "%.2f" $detail.FlakeScore}}
                </span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Mixed Outcome Runs</div>
            <div class="stat-value">{{$detail.MixedOutcomeRuns}}</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Total Runs Seen</div>
            <div class="stat-value">{{$detail.TotalRunsSeen}}</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">First Seen</div>
            <div class="stat-value">{{ $detail.FirstSeenAt.Format "2006-01-02" }}</div>
        </div>
    </div>

    {{if .Data.LastFailureMessageDisplay}}
    <h3>Last Failure Message</h3>
    <div class="card mb-2">
        <pre class="code-block">{{.Data.LastFailureMessageDisplay}}</pre>
        {{if .Data.LastFailureMessageTruncated}}
        <div class="text-muted mt-1">Displayed message truncated to 500 characters.</div>
        {{end}}
        {{if .Data.LastFailureMessageIngestionTruncated}}
        <div class="text-muted mt-1">Ingestion truncated the original message.</div>
        {{end}}
    </div>
    {{end}}

    <h3>Flake Evidence</h3>
    <p class="text-muted mb-1">Showing {{len $detail.Evidence}} of {{.Data.EvidenceTotal}} event(s)</p>

    {{if eq (len $detail.Evidence) 0}}
    <div class="empty-state">
        <p class="mb-0">No evidence found for this flake.</p>
    </div>
    {{else}}
    <table class="evidence-table">
        <thead>
            <tr>
                <th>GitHub Run</th>
                <th>SHA</th>
                <th>Failed Attempt</th>
                <th>Passed Attempt</th>
                <th>Failed At</th>
                <th>Passed At</th>
            </tr>
        </thead>
        <tbody>
            {{range $detail.Evidence}}
            <tr>
                <td>
                    {{if .RunURL}}
                    <a href="{{.RunURL}}" target="_blank" rel="noopener noreferrer" class="link">{{.GitHubRunID}}</a>
                    {{else}}
                    <span class="code-pill">{{.GitHubRunID}}</span>
                    {{end}}
                </td>
                <td><span class="code-pill">{{printf "%.7s" .SHA}}</span></td>
                <td><span class="code-pill">#{{.AttemptFailed}}</span></td>
                <td><span class="code-pill">#{{.AttemptPassed}}</span></td>
                <td>{{if .FailedAt}}{{.FailedAt.Format "2006-01-02 15:04"}}{{else}}&mdash;{{end}}</td>
                <td>{{if .PassedAt}}{{.PassedAt.Format "2006-01-02 15:04"}}{{else}}&mdash;{{end}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>

    {{if ge .Data.EvidenceTotal 100}}
    <p class="text-muted mt-1">Showing most recent 100 events.</p>
    {{end}}
    {{end}}
</div>
{{end}}
